<!DOCTYPE html>
<html>

<head>
    <title>Open Source Licenses: A Deep Dive into Their Meaning</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

    <script type="module" src="/scripts/main.js" defer></script>

    <link rel="stylesheet" type="text/css" href="/styles/styles.css">

    <script type="module" src="/scripts/prism.js" defer></script>
    <link rel="stylesheet" type="text/css" href="/styles/prism.css">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>


<body>
    <div id="header-container"></div>


    <main class="main-post">
        <h1>Consume the Input Only When <code class="language-rust">Some&lt;T&gt;</code> is returned</h1>

        <p>
        <code class="language-rust">Option&lt;T></code> is ubiquitous in Rust. It is used to represent a value that may or may not be present: every <code class="language-rust">Option&lt;T></code> is either <code class="language-rust">Some&lt;T&gt;</code> or <code class="language-rust">None</code>. This is a powerful concept that allows for safe handling of optional values without the need for null references.
        <br>
        <br>
        </p>

        <p>
        <b>Problem Statement.</b> &nbsp;
        However, sometimes, given a function <code class="language-rust">fn f&lt;T, F>(t: T) -&gt; Option&lt;F></code> that takes the ownership of the input <code class="language-rust">t</code> and returns an <code class="language-rust">Option&lt;F></code>, we want to <i>consume</i><a id="footnote-1-ref" href="#footnote-1"><sup>1</sup></a> the input only when <code class="language-rust">Some&lt;F&gt;</code> is returned. This is particularly useful when we want to avoid unnecessary cloning or copying of data.
        Now, let us consider the following example (<a href="https://play.rust-lang.org/?version=stable&mode=debug&edition=2024&gist=da48bcc18f88582f358adda7c922d448">playground</a>):
        </p>

        <pre class="line-numbers" data-line="15-17">
        <code class="language-rust">
        #[derive(Debug)]
        struct ZST;

        fn foo&lt;T: std::fmt::Debug&gt;(p: Option&lt;T&gt;) -&gt; Option&lt;String&gt; {
            if p.is_some() {
                return Some(format!("{:?}", p));
            }
            None
        }

        fn main() {
            let input = ZST;
            match foo(Some(input)) {
                Some(x) =&gt; { /* Do something with x */ }
                None =&gt; {
                    let x = input;
                }
            }
        }
        </code>
        </pre>

        <p>
        The Rust compiler rejects this code with the following error:
        </p>

        <pre>
        <code class="language-bash">
        </code>
        error[E0382]: use of moved value: `input`
          --> src/main.rs:16:21
           |
        12 |     let input = ZST;
           |         ----- move occurs because `input` has type `ZST`, which does not implement the `Copy` trait
        13 |     match foo(Some(input)) {
           |                    ----- value moved here
        ...
        16 |             let x = input;
           |                     ^^^^^ value used here after move
        </pre>

        <p>
        The error occurs because the input is moved into the function <code class="language-rust">foo</code>, and then it is used again in the <code class="language-rust">None</code> branch of the match statement (lines 15-17 highlighted in the code above). This is not allowed in Rust, as it violates the ownership rules.
        </p>

        <p id="footnote-1">
        <br>
        <br>
        <sup>1</sup> <i>Consume</i> means to take ownership of the input and make it unavailable for further use. In Rust, this is typically done by passing the input to a function that takes ownership of it. This is in contrast to <i>borrowing</i>, where the input is passed to a function that does not take ownership of it and can be used later.
        <a href="#footnote-1-ref" title="return to text">&#8617;</a>
        </p>

    </main>
    <div id="footer-container"></div>
</body>

</html>
